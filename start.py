"""一个将多语言表格转化为 Android string.xml 以及 iOS Localizable.strings 的脚本2018.10.25 新增支持将新增多语言直接写入 iOS 或 Android 项目的多语言文件使用方法参考 GitHub ReadMeAuthor: YangJiachengGithub : https://github.com/caelanyang/XlsToXmlDate: 2017.12"""from optparse import OptionParserfrom importlib import reloadimport sysimport xlrdimport osdef add_parser():    parser = OptionParser()    parser.add_option("-f", "--file_path",                      help="original.xls File Path.",                      metavar="file_path", type=str)    parser.add_option("-t", "--target_path",                      help="Target Folder Path.",                      metavar="target_path", type=str)    parser.add_option("-w", "--mobile_os",                      help="Target Mobile OS, 0 is iOS and 1 is Android.",                      metavar="mobile_os", type=int, default=-1)    (options, args) = parser.parse_args()    print("options: %s, args: %s" % (options, args))    return optionsdef start_convert(options):    file_path = options.file_path    target_path = options.target_path    write_to_project = options.mobile_os    if file_path is not None:        if target_path is None:            print("targetPath is None！use -h for help.")            return        print("read xls file from: " + file_path)        xls_file = XlsUtil(file_path)        table = xls_file.get_table_by_index(0)        convert_file(table, target_path, write_to_project)        print("Finished, see: " + target_path)    else:        print().error("file path is None！use -h for help.")def convert_file(table, target_path, write_to_project):    first_row = table.row_values(0)    keys = table.col_values(0)    del keys[0]    for index in range(len(first_row)):        if index > 0:            language_name = first_row[index]            values = table.col_values(index)            del values[0]            write_to_file(keys, values, target_path, language_name, write_to_project)class XlsUtil:    def __init__(self, file_path):        self.filePath = file_path        reload(sys)        self.data = xlrd.open_workbook(file_path)    def get_table_by_index(self, index):        if 0 <= index < len(self.data.sheets()):            return self.data.sheets()[index]        else:            print("XlsUtil error -- getTable: " + index)def write_to_file(keys, values, target_path, language_name, write_to_project):    if not os.path.exists(target_path):        os.makedirs(target_path)    print("reading language for: " + language_name + " to " + target_path + "/strings.xml")    print("reading language for: " + language_name + " to " + target_path + "/Localizable.strings")    fo_for_android = open(target_path + "/strings.xml", "a", encoding="utf8")    fo_for_ios = open(target_path + "/Localizable.strings", "a", encoding="utf8")    fo_for_project = None    if language_name is not None:        fo_for_android.write(language_name + "\n")        fo_for_ios.write(language_name + "\n")        project_path = None        if write_to_project == 0:            project_path = language_name + ".lproj" + "/Localizable.strings"        elif write_to_project == 1:            if language_name == "en":                project_path = "values" + "/strings.xml"            else:                project_path = "values-" + language_name + "/strings.xml"        if project_path:            new_file = False            dir_path = os.path.split(project_path)[0]            if not os.path.exists(dir_path):                os.makedirs(dir_path)                new_file = True            if not os.path.exists(project_path):                os.system(r"touch {}".format(project_path))            fo_for_project = open(project_path, "a", encoding="utf8")            if write_to_project == 1:                if new_file:                    fo_for_project.write('<?xml version="1.0" encoding="utf-8" standalone="no"?> \n')                    fo_for_project.write("<resources>")                else:                    read_temp = open(project_path, "r", encoding="utf8")                    lines = read_temp.readlines()                    read_temp.close()                    lines = lines[:-1]                    temp = open(project_path, "w", encoding="utf8")                    temp.writelines(lines)                    temp.close()    if fo_for_project:        fo_for_project.write("\n")        fo_for_project.write("\n")    for x in range(len(keys)):        if values[x] is None or values[x] == '':            print("Key:" + keys[x] + "\'s value is None. Index:" + str(x + 1))            continue        key = keys[x]        value = values[x]        if ~isinstance(value, str):            value = str(value)        if ~isinstance(key, str):            key = str(key)        content = "<string name=\"" + key + "\">" + value + "</string>\n"        key.strip()        content_for_ios = "\"" + key + "\" " + "= " + "\"" + value + "\";\n"        fo_for_android.write(content)        fo_for_ios.write(content_for_ios)        if fo_for_project:            if write_to_project == 0:                fo_for_project.write(content_for_ios)            else:                content = "    " + content                fo_for_project.write(content)    fo_for_android.write("\n")    fo_for_android.close()    fo_for_ios.write("\n")    fo_for_ios.close()    if fo_for_project:        fo_for_project.write("\n")        if write_to_project == 1:            fo_for_project.write("</resources>")        fo_for_project.close()# def get_file_last_line(input_file):#     file_size = os.path.getsize(input_file)#     block_size = 1024#     with open(input_file, 'rb') as f:#         last_line = ""#         if file_size > block_size:#             max_seek_point = (file_size // block_size)#             f.seek((max_seek_point - 1) * block_size)#         elif file_size:#             f.seek(0, 0)#         lines = f.readlines()#         if lines:#             line_no = 1#             while last_line == "":#                 last_line = lines[-line_no].strip()#                 line_no += 1#         return last_linedef main():    options = add_parser()    start_convert(options)main()